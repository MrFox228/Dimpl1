<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–æ–≤–∞—Ä—ã - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫–ª–∞–¥–æ–º</title>
    <link rel="stylesheet" href="../static/styles.css">
    <style>
        body {
            display: flex;
            margin: 0;
            font-family: Arial, sans-serif;
        }

        .modal input, .edit-modal input{
            border-radius: 10px;
            border: 1.2px solid #333;
        }

        .search-index{
            padding: 10px;
            border-radius: 10px;
            border: 2px solid #333;
        }
        
        button,filter{
            padding:10px;
            border-radius:10px;
            border:2px solid #595959;
            margin-bottom: 20px;
        }

        nav {
            width: 200px;
            background: #333;
            color: white;
            height: 100vh;
            padding-top: 20px;
            position: fixed;
        }
        nav ul {
            list-style: none;
            padding: 0;
        }
        nav ul li {
            padding: 10px;
            text-align: center;
        }
        nav ul li a {
            color: white;
            padding: 5px;
            text-decoration: none;
            display: block;
        }
        nav ul li a:hover {
            background: #555;
        }
        main {
            margin-left: 220px;
            padding: 20px;
            flex: 1;
        }
        .modal, .edit-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
        }
        .modal-content, .edit-modal-content {
            background: white;
            padding: 20px;
            width: 300px;
            margin: 15% auto;
            text-align: center;
            border-radius: 8px;
        }
        .modal input, .edit-modal input {
            display: block;
            width: 90%;
            margin: 10px auto;
            padding: 5px;
        }
        .modal button, .edit-modal button {
            margin: 10px;
        }
    </style>
</head>
<body>
    <nav>
        <ul>
            <li><a href="/index">–ó–∞–ø–∏—Å–∏</a></li>
            <li><a href="/products">–¢–æ–≤–∞—Ä—ã</a></li>
            <li><a href="/purchases" style="background: #555;">–ü—Ä–∏—Ö–æ–¥—ã</a></li>
            <li><a href="/sales">–ü—Ä–æ–¥–∞–∂–∏</a></li>
            <li><a href="/logout">–í—ã–π—Ç–∏</a></li>
        </ul>
    </nav>

    <main>
        <h2>–°–ø–∏—Å–æ–∫ –ø—Ä–∏—Ö–æ–¥–æ–≤</h2>
        <input class="search-index" type="text" id="search" placeholder="–ü–æ–∏—Å–∫...">
        <button class="add-index" onclick="openModal()">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏—Ö–æ–¥</button>
        <select class="filter" id="sortFilter" onchange="sortTable()">
            <option value="none">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</option>
            <option value="id_asc">–ê–π–¥–∏ (–≤–æ–∑—Ä.)</option>
            <option value="id_desc">–ê–π–¥–∏ (—É–±—ã–≤.)</option>
            <option value="date_asc">–î–∞—Ç–∞ (–≤–æ–∑—Ä.)</option>
            <option value="date_desc">–î–∞—Ç–∞ (—É–±—ã–≤.)</option>
            <option value="provider_asc">–ü–æ—Å—Ç–∞–≤—â–∏–∫ (–ê-–Ø)</option>
            <option value="provider_desc">–ü–æ—Å—Ç–∞–≤—â–∏–∫ (–Ø-–ê)</option>
            <option value="quantity_asc">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (–≤–æ–∑—Ä.)</option>
            <option value="quantity_desc">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—É–±—ã–≤.)</option>
            <option value="price_asc">–°—É–º–º–∞ (–≤–æ–∑—Ä.)</option>
            <option value="price_desc">–°—É–º–º–∞ (—É–±—ã–≤.)</option>
        </select>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>–î–∞—Ç–∞</th>
                    <th>–ü–æ—Å—Ç–∞–≤—â–∏–∫</th>
                    <th>–¢–æ–≤–∞—Ä—ã</th>
                    <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                    <th>–°—É–º–º–∞</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody id="data-list">
                <tr>
                    <td>1</td>
                    <td>2025-03-05</td>
                    <td>–ü–æ—Å—Ç–∞–≤—â–∏–∫ 1</td>
                    <td>–¢–æ–≤–∞—Ä 1, –¢–æ–≤–∞—Ä 2</td>
                    <td>52</td>
                    <td>5000 —Ç–≥.</td>
                    <td>
                        <button onclick="editRow(this)">‚úèÔ∏è</button>
                        <button onclick="deleteRow(this)">üóëÔ∏è</button>
                    </td>
                </tr>
                {% for el in data %}
                <tr>
                    <td>{{ el.id }}</td>
                    <td>{{ el.data }}</td>
                    <td>{{ el.provider }}</td>
                    <td>{{ el.products }}</td>
                    <td>{{ el.quantity }}</td>
                    <td>{{ el.price }} —Ç–≥.</td>
                    <td>
                        <button onclick="editRow(this)">‚úèÔ∏è</button>
                        <button onclick="deleteRow(this)">üóëÔ∏è</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </main>

    <div id="modal" class="modal">
        <div class="modal-content">
            <h3>–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏—Ö–æ–¥</h3>
            <input type="number" id="modal-id" placeholder="ID">
            <input type="date" id="modal-desc" placeholder="–î–∞—Ç–∞">
            <input type="text" id="modal-provider" placeholder="–ü–æ—Å—Ç–∞–≤—â–∏–∫">
            <input type="text" id="modal-products" placeholder="–¢–æ–≤–∞—Ä—ã">
            <input type="text" id="modal-quantity" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ">
            <input type="text" id="modal-price" placeholder="–°—É–º–º–∞">
            <button onclick="saveData()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>
    <div id="edit-modal" class="edit-modal">
        <div class="edit-modal-content">
            <h3>–ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∏—Ö–æ–¥</h3>
            <input type="number" id="edit-modal-id" placeholder="ID">
            <input type="date" id="edit-modal-desc" placeholder="–î–∞—Ç–∞">
            <input type="text" id="edit-modal-provider" placeholder="–ü–æ—Å—Ç–∞–≤—â–∏–∫">
            <input type="text" id="edit-modal-products" placeholder="–¢–æ–≤–∞—Ä—ã">
            <input type="text" id="edit-modal-quantity" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ">
            <input type="text" id="edit-modal-price" placeholder="–°—É–º–º–∞">
            <button onclick="editRowSave()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button onclick="editcloseModal()">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <script>
        function openModal() {
            document.getElementById("modal").style.display = "block";
        }
    
        function closeModal() {
            document.getElementById("modal").style.display = "none";
        }
        function editcloseModal() {
            document.getElementById("edit-modal").style.display = "none";
        }
    
        function saveData() {
            let id = document.getElementById("modal-id").value;
            let data = document.getElementById("modal-desc").value;
            let provider = document.getElementById("modal-provider").value;
            let products = document.getElementById("modal-products").value;
            let quantity = document.getElementById("modal-quantity").value;
            let price = document.getElementById("modal-price").value;
    
            if (!id || !data || !provider || !products || !quantity || !price) {
                alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!");
                return;
            }
    
            let url = `http://127.0.0.1:8000/add-purchases/${id}/${data}/${provider}/${products}/${quantity}/${price}`;
            window.location.href = url;
        }
    
        function editRow(btn) {
            let row = btn.closest("tr"); 
            if (!row) return; 
        
            let id = row.cells[0]?.innerText;
            let data = row.cells[1]?.innerText;
            let provider = row.cells[2]?.innerText;
            let products = row.cells[3]?.innerText;
            let quantity = row.cells[4]?.innerText;
            let price = row.cells[5]?.innerText.replace(" —Ç–≥.", "").trim();
        
            if (!id || !data || !provider || !products || !quantity || !price) {
                alert("–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏.");
                return;
            }
        
            document.getElementById("edit-modal-id").value = id;
            document.getElementById("edit-modal-desc").value = data;
            document.getElementById("edit-modal-provider").value = provider;
            document.getElementById("edit-modal-products").value = products;
            document.getElementById("edit-modal-quantity").value = quantity;
            document.getElementById("edit-modal-price").value = price;
        
            let modal = document.getElementById("edit-modal");
            modal.setAttribute("data-row-id", id);
            modal.setAttribute("data-row-desc", data);
            modal.setAttribute("data-row-provider", provider);
            modal.setAttribute("data-row-products", products);
            modal.setAttribute("data-row-quantity", quantity);
            modal.setAttribute("data-row-price", price);
            modal.style.display = "block";
        }
        
    
        function editRowSave() {
            let id = document.getElementById("edit-modal-id").value;
            let data = document.getElementById("edit-modal-desc").value;
            let provider = document.getElementById("edit-modal-provider").value;
            let products = document.getElementById("edit-modal-products").value;
            let quantity = document.getElementById("edit-modal-quantity").value;
            let price = document.getElementById("edit-modal-price").value;
    
            let modal = document.getElementById("edit-modal");
            let oldId = modal.getAttribute("data-row-id");
            let oldData = modal.getAttribute("data-row-desc");
            let oldProvider = modal.getAttribute("data-row-provider");
            let oldProducts = modal.getAttribute("data-row-products");
            let oldQuantity = modal.getAttribute("data-row-quantity");
            let oldPrice = modal.getAttribute("data-row-price");
    
            if (!id || !data || !provider || !products || !quantity || !price) {
                alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!");
                return;
            }
    
            console.log(`–°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ: ID=${oldId}, –û–ø–∏—Å–∞–Ω–∏–µ=${oldData}, –ü—Ä–æ–≤–∞–π–¥–µ—Ä=${oldProvider}, –¢–æ–≤–∞—Ä—ã= ${oldProducts}, –ö–æ–ª-–≤–æ=${quantity},–¶–µ–Ω–∞=${oldPrice}`);
            console.log(`–ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ: ID=${id}, –û–ø–∏—Å–∞–Ω–∏–µ=${data}, –ü—Ä–æ–≤–∞–π–¥–µ—Ä=${provider}, –¢–æ–≤–∞—Ä—ã=${products}, –ö–æ–ª-–≤–æ=${quantity}, –¶–µ–Ω–∞=${price}`);
    
            let url = `http://127.0.0.1:8000/edit-purchases/${id}/${data}/${provider}/${products}/${quantity}/${price}/${oldId}/${oldData}/${oldPrice}/${oldProducts}/${oldProvider}/${oldQuantity}`;
            window.location.href = url;
        }
    
        function deleteRow(btn) {
            let row = btn.closest("tr"); 
            if (!row) return; 
        
            let id = row.cells[0]?.innerText;
            let data = row.cells[1]?.innerText;
            let provider = row.cells[2]?.innerText;
            let products = row.cells[3]?.innerText;
            let quantity = row.cells[4]?.innerText;
            let price = row.cells[5]?.innerText;
            
            if (!id || !data || !provider || !products ||!quantity || !price) {
                alert("–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏.");
                return;
            }
        
            let url = `http://127.0.0.1:8000/del-purchases/${id}/${data}/${provider}/${products}/${quantity}/${price}`;
            window.location.href = url;
        }
        
        function sortTable() {
            let table = document.getElementById("data-list");
            let rows = Array.from(table.rows);
            let filter = document.getElementById("sortFilter").value;
            
            rows.sort((a, b) => {
                let valA, valB;
                switch (filter) {
                    case "id_asc":
                    return parseFloat(a.cells[0].innerText) - parseFloat(b.cells[0].innerText);
                    case "id_desc":
                        return parseFloat(b.cells[0].innerText) - parseFloat(a.cells[0].innerText);
                    case "name_asc":
                        valA = a.cells[1].innerText.toLowerCase();
                        valB = b.cells[1].innerText.toLowerCase();
                        return valA.localeCompare(valB);
                    case "name_desc":
                        valA = a.cells[1].innerText.toLowerCase();
                        valB = b.cells[1].innerText.toLowerCase();
                        return valB.localeCompare(valA);
                    case "price_asc":
                        return parseFloat(a.cells[5].innerText) - parseFloat(b.cells[5].innerText);
                    case "price_desc":
                        return parseFloat(b.cells[5].innerText) - parseFloat(a.cells[5].innerText);
                    case "quantity_asc":
                        return parseInt(a.cells[4].innerText) - parseInt(b.cells[4].innerText);
                    case "quantity_desc":
                        return parseInt(b.cells[4].innerText) - parseInt(a.cells[4].innerText);
                    case "provider_asc":
                        valA = a.cells[1].innerText.toLowerCase();
                        valB = b.cells[1].innerText.toLowerCase();
                        return valA.localeCompare(valB);
                    case "provider_desc":
                        valA = a.cells[1].innerText.toLowerCase();
                        valB = b.cells[1].innerText.toLowerCase();
                        return valB.localeCompare(valA);
                    case "date_asc":
                        return new Date(a.cells[1].innerText) - new Date(b.cells[1].innerText);
                    case "date_desc":
                        return new Date(b.cells[1].innerText) - new Date(a.cells[1].innerText);
                    default:
                        return 0;
                }
            });
            
            table.innerHTML = "";
            rows.forEach(row => table.appendChild(row));
        }

        document.addEventListener("DOMContentLoaded", function () {
            document.getElementById("search").addEventListener("input", function () {
                let searchValue = this.value.toLowerCase();
                document.querySelectorAll("#data-list tr").forEach(row => {
                    let text = row.innerText.toLowerCase();
                    row.style.display = text.includes(searchValue) ? "" : "none";
                });
            });
        });
        
    </script>
    
</body>
</html>